# 玩转Linux操作系统

## Linux概述
Linux是一个通用操作系统。一个操作系统要负责任务调度、内存分配、处理外围设备I/O等操作。
操作系统通常由内核（运行其他程序，管理像磁盘、打印机等硬件设备的核心程序）和系统程序（设备驱动、底层库、shell、服务程序等）两部分组成。

**基础命令**

```
-history # 查看历史会话
```

**实用程序**
1. 文件和文件夹操作 - mkdir/rmdir
```
[root ~]# mkdir abc # 创建文件夹
[root ~]# mkdir -p xyz/abc # -p 一次性创建多层文件
[root ~]# rmdir abc # 删除文件夹
```
2.  创建/删除文件 - touch / rm。
```
[root ~]# touch readme.txt
[root ~]# touch error.txt
[root ~]# rm error.txt
rm: remove regular empty file ‘error.txt’? y
[root ~]# rm -rf xyz
```
`touch`有两个功能：
(1). 是用于把已存在文件的时间标签更新为系统当前的时间（默认方式），它们的数据将原封不动地保留下来；
(2). 是用来创建新的空文件。

3. 拷贝，移动文件 -cp/mv。
4. 查看目录内容： -ls
     - `-l`: 以长格式查看文件和目录
     - `-a`: 显示以点开头的文件和目录（隐藏文件）。
     - `-R`: 遇到目录要进行递归展开（继续列出目录下面的文件和目录）
     - `-d`: 只列出目录，不列出其他内容。
     - `-S`/`-t`: 按大小/时间排序。
  
5. 切换和查看当前工作目录 - cd / pwd。
6. 查看文件内容 - cat / tac / head / tail / more / less / rev / od。
7. 文件重命名 - rename。
8. 查找文件和查找内容 - find / grep。
9. 压缩/解压缩和归档/解归档 - gzip / gunzip / xz。
10. 将标准输入转成命令行参数 - xargs。

**管道和重定向**

1. 重定向：

有些时候想要保存某个命令的输出,而不仅仅只是让它显示在显示器Q上。bash shell提供了几个操作符,可以将命令的输出重定向到另一个位置(比如文件)。重重定向可以用于输入,也可以用于输出,可以将文件重定向到命令输入。

- 输出重定向：将命令的输出发送到一个文件中，用`>`完成
- 
  注意，使用命令`command -> outputfile`，会覆盖`outputfile`之前的内容
```
[root ~]# cat readme.txt
banana
apple
grape
apple
grape
watermelon
pear
pitaya
[root ~]# cat readme.txt | sort | uniq > result.txt
[root ~]# cat result.txt
apple
banana
grape
pear
pitaya
watermelon
```

- 输入重定向：给定linux命令一个输入来源来取代标准输入，对输入来源进行处理，然后输出到标准输出，用`<`

2. 管道：

用于进程间的通信，是将前面每一个进程的输出直接作为下一个进程的输入

例如：查找当前目录下文件的个数
```
[root ~]# find ./ | wc -l
6152
```

**文件操作**

1. 字符流编辑器 - sed。sed 可依照脚本的指令来处理、编辑文本文件。

     - a ：新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)～
     - c ：取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！
     - d ：删除，因为是删除，所以 d 后面通常不接任何东东；
     - i ：插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；
     - p ：打印，亦即将某个选择的数据印出。通常 p 会与参数 sed -n 一起运行～
     - s ：取代，可以直接进行取代的工作哩！通常这个 s 的动作可以搭配正则表达式！例如 1,20s/old/new/g 就是啦！

例如:

```
[root ~]# cat -n fruit.txt 
     1  banana
     2  grape
     3  apple
     4  watermelon
     5  orange

# 然后可以添加或删除内容，注意这只是将新内容输出到终端中，如果要保存到文件还是需要输出重定向

[root ~]# sed '2a pitaya' fruit.txt  # 在第二行后插入
banana
grape
pitaya
apple
watermelon
orange

[root ~]# sed '2,3, 4d' fruit.txt # 删除2，3，4行内容
banana
orange

[root ~]# sed 's#a#@#' fruit.txt # 将文本中的字符a替换为@，只替换每一行中的第一个字符，如果要全部替换，使用g进入全局模式
b@nana
gr@pe
@pple
w@termelon
or@nge
```

2. 模式匹配和处理语言 - awk。

awk是一种编程语言，也是Linux系统中处理文本最为强大的工具，通过该命令可以从文本中提取出指定的列、用正则表达式从文本中取出我们想要的内容、显示指定的行以及进行统计和运算。

awk 的执行流程是从输入文件（或标准输入）逐行读取内容，然后对每行数据检查是否符合指定的模式（如 NR==3），之后执行操作。如果未指定操作，那么默认动作是print，即输出整行内容。

命令格式：`awk 选项 ‘模式或条件 {操作}’ 文件 1 文件 2 …`

wak 常见的内建变量：

     - FS：列分割符。指定每行文本的字段分隔符，默认为空格或制表位。与"-F"作用相同
     - NF：当前处理的行的字段个数。
     - NR：当前处理的行的行号（序数）。
     - $0：当前处理的行的整行内容。awk 中列的编号从 1 开始，$0 代表整行，没有$0列的概念。
     - $n：当前处理行的第n个字段（第n列）。
     - FILENAME：被处理的文件名。
     - RS：行分隔符。awk从文件上读取资料时,将根据RS的定义把读取的资料切割成许多条记录,而awk一次仅读入一条记录,以进行处理。预设值是’\n’

例如：
```
[root ~]# awk 'NR==3' fruit2.txt  # 显示文件的第三行
3       apple       1230

[root ~]# awk '{print $2}' fruit2.txt  # 显示文件的第二列
banana
grape
apple
watermelon
orange

[root ~]# awk '{print $NF}' fruit2.txt # 显示最后一列
120
500
1230
80
400

[root ~]# awk '{if($3 >= 300) {print $0}}' fruit2.txt # 输出末尾数字大于等于300的行。（文件一共三列）
2       grape       500
3       apple       1230
5       orange      400

```

3. 编辑器 - vim

基本上 vi/vim 共分为三种模式，命令模式（Command Mode）、输入模式（Insert Mode）和命令行模式（Command-Line Mode）

1. 启动vim。可以通过`vi`或`vim`命令来启动vim，启动时可以指定文件名来打开一个文件，如果没有指定文件名，也可以在保存的时候指定文件名。
```
[root ~]# vim guess.py
```

2. 启动vim进入的是命令模式（也称为Normal模式），在命令模式下输入英文字母`i`会进入编辑模式（Insert模式），屏幕下方出现-- INSERT --提示；在编辑模式下按下`Esc`会回到命令模式，此时如果输入英文`:`会进入末行模式，在末行模式下输入`q!`可以在不保存当前工作的情况下强行退出vim，也可以进行文件的保存等；在命令模式下输入v会进入可视模式（Visual模式），可以用光标选择一个区域再完成对应的操作。
   
3. 保存和退出vim：在命令模式下输入`: `进入末行模式，输入`wq`可以实现保存退出；如果想放弃编辑的内容输入`q!`强行退出，这一点刚才已经提到过了；在命令模式下也可以直接输入`ZZ`实现保存退出。如果只想保存文件不退出，那么可以在末行模式下输入`w；`可以在`w`后面输入空格再指定要保存的文件名。

4. 光标操作。在命令模式下可以通过h、j、k、l来控制光标向左、下、上、右的方向移动，可以在字母前输入数字来表示移动的距离，例如：10h表示向左移动10个字符。在命令模式下可以通过Ctrl+y和Ctrl+e来实现向上、向下滚动一行文本的操作，可以通过Ctrl+f和Ctrl+b来实现向前和向后翻页的操作。在命令模式下可以通过输入英文字母G将光标移到文件的末尾，可以通过gg将光标移到文件的开始，也可以通过在G前输入数字来将光标移动到指定的行。

vim还可以打开多个文件，进行窗口的拆分和切换等。

4. 计划任务

   (1).在指定的时间执行命令。
        - at： 将任务排队，在指定的时间执行。
        - atq： 查看待执行的任务队列。
        - atrm： 从队列中删除待执行的任务。

指定3天以后下午5点要执行的任务。
```
[root ~]# at 5pm+3days
at> rm -f /root/*.html
at> <EOT>
job 9 at Wed Jun  5 17:00:00 2019
```


